(this["webpackJsonphome-secure-monitor"]=this["webpackJsonphome-secure-monitor"]||[]).push([[0],{2:function(e,t,n){e.exports={liveVideo:"LiveVideo_liveVideo__1ZkFR",motion:"LiveVideo_motion__2L80a",controls:"LiveVideo_controls__kPM7Y",name:"LiveVideo_name__2UIOL"}},29:function(e,t,n){e.exports=n(64)},34:function(e,t,n){},36:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(26),i=n.n(c),r=(n(34),n(14)),s=n.n(r),l=n(27),u=n(1),h=(n(36),n(28)),m=n.n(h),f=function(e){var t=e.canvas,n=e.url,a=e.onStart,o=e.onMessage,c=new WebSocket(n,"echo-protocol");c.binaryType="arraybuffer";var i=new m.a(t,"webgl",1,35),r=!1,s=function(e){c.send(JSON.stringify(e))},l=function(){c.close()};c.onopen=function(){console.log("socket is connected"),c.send(JSON.stringify({name:"camera",state:"timelapse"}))},c.onclose=function(e){console.log("socket is closed",e)},c.onerror=function(e){console.log("socket error",e)},c.onmessage=function(e){if("string"==typeof e.data){var t=JSON.parse(e.data);if(r||"camera"!==t.name||"settings"!==t.event)o&&o(t),console.log(t);else{var n=t.content,c=n.width,u=n.height;i.initCanvas(c,u),r=!0,a?a({width:c,height:u,send:s,close:l}):o&&o(t.content)}}else{var h=new Uint8Array(e.data);i.addFrame(h)}}},d=n(2),v=n.n(d),g=function(e){var t=e.name,n=e.url,c=Object(a.useState)("off"),i=Object(u.a)(c,2),r=i[0],s=i[1],l=Object(a.useState)({}),h=Object(u.a)(l,2),m=h[0],d=h[1],g=Object(a.useState)({}),p=Object(u.a)(g,2),w=p[0],b=p[1],O=Object(a.useState)(!1),j=Object(u.a)(O,2),E=j[0],k=j[1],y=Object(a.useRef)(),S=Object(a.useRef)();Object(a.useEffect)((function(){return"off"===r&&(f({canvas:y.current,url:n,onStart:b,onMessage:function(e){"camera"===e.name&&"motion"===e.event&&(k(!0),setTimeout((function(){k(!1)}),2e3))}}),s("timelapse")),function(){console.log("cleanup LiveVideo component"),w.close&&w.close()}}),[n]),Object(a.useEffect)((function(){var e=S.current.getBoundingClientRect(),t={width:e.width-4,height:e.height-4};t.width===m.width&&t.height===m.height||d(t)}),[m]);var _={};if(m.height&&w.height){var N=m.width/m.height,V=w.width/w.height;_=N>V?{width:m.height*V,height:m.height}:{width:m.width,height:m.width/V}}return o.a.createElement("div",{className:v.a.liveVideo+(E?" "+v.a.motion:""),ref:S},o.a.createElement("div",{className:v.a.controls},o.a.createElement("span",{className:v.a.name},t),o.a.createElement("button",{onClick:function(){var e="on"===r?"timelapse":"on";s(e),w.send({name:"camera",state:e})}},"on"===r?"\u23f8\ufe0e":"\u23f5\ufe0e")),o.a.createElement("canvas",{className:v.a.video,ref:y,style:_}))},p=document.location.href.startsWith("http://localhost")?"http://garage:45738/cameras":"/cameras";var w=function(){var e=Object(a.useState)([]),t=Object(u.a)(e,2),n=t[0],c=t[1];Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(p);case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,c(n.cameras);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e();var t=setInterval(e,1e4);return function(){clearInterval(t)}}),[]);var i=[];if(window.innerWidth>window.innerHeight&&n.length>1){var r=Math.ceil(n.length/2);i=[n.slice(0,r),n.slice(r)]}else i=n.map((function(e){return[e]}));return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"App-content"},i.map((function(e,t){return o.a.createElement("div",{className:"App-row",key:"row-".concat(t)},e.map((function(e){return o.a.createElement(g,{name:e.name,url:e.address,key:e.name})})))}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.e405d737.chunk.js.map